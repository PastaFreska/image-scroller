<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scrolller Gallery</title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; padding: 20px; text-align: center; }
    .controls { margin-bottom: 20px; }
    .controls label { display: block; margin: 10px 0; }
    #gallery { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .item { max-width: 300px; max-height: 300px; overflow: hidden; border: 2px solid #444; border-radius: 8px; }
    .item img, .item video { width: 100%; display: block; }
  </style>
</head>
<body>
  <h1>Scrolller Image & GIF Gallery</h1>
  <div class="controls">
    <label>
      Number of items: <span id="countLabel">6</span>
      <input type="range" id="countSlider" min="1" max="20" value="6" oninput="updateCount()">
    </label>
    <label>
      NSFW ratio: <span id="ratioLabel">30%</span>
      <input type="range" id="ratioSlider" min="0" max="100" value="30" oninput="updateRatio()">
    </label>
    <button onclick="loadGallery()">ðŸ”„ Load Gallery</button>
  </div>
  <div id="gallery">Loadingâ€¦</div>

  <script>
    const sfwApi = 'https://api.scrolller.com/api/v2/category/sfw';
    const nsfwApi = 'https://api.scrolller.com/api/v2/category/nsfw';

    const countSlider = document.getElementById('countSlider');
    const ratioSlider = document.getElementById('ratioSlider');
    const countLabel = document.getElementById('countLabel');
    const ratioLabel = document.getElementById('ratioLabel');
    const gallery = document.getElementById('gallery');

    function updateCount() {
      countLabel.textContent = countSlider.value;
    }

    function updateRatio() {
      ratioLabel.textContent = ratioSlider.value + '%';
    }

    async function fetchItems(apiUrl) {
      try {
        const res = await fetch(apiUrl);
        const json = await res.json();
        return json.posts || [];
      } catch {
        return [];
      }
    }

    async function loadGallery() {
      gallery.innerHTML = 'Loadingâ€¦';

      const total = parseInt(countSlider.value);
      const nsfwRatio = parseInt(ratioSlider.value) / 100;

      // Fetch a pool of posts once
      const [sfwAll, nsfwAll] = await Promise.all([fetchItems(sfwApi), fetchItems(nsfwApi)]);
      const items = [];

      // Randomly pick until we reach total count
      while (items.length < total) {
        const pickNSFW = Math.random() < nsfwRatio;
        const source = pickNSFW ? nsfwAll : sfwAll;
        if (!source.length) break;
        const post = source[Math.floor(Math.random() * source.length)];
        items.push(post);
      }

      gallery.innerHTML = ''; 
      items.forEach(post => {
        const container = document.createElement('div');
        container.className = 'item';

        // Handle GIFs and videos
        if (post.isGif) {
          const video = document.createElement('video');
          video.src = post.gifUrl || post.url;
          video.autoplay = video.loop = video.muted = true;
          container.appendChild(video);
        } else {
          const img = document.createElement('img');
          img.src = post.url;
          container.appendChild(img);
        }

        gallery.appendChild(container);
      });
    }

    window.onload = () => {
      updateCount();
      updateRatio();
      loadGallery();
    };
  </script>
</body>
</html>
